var LakeScraper=function(e){var s=this;this.lakes=e,this.statusText=$("#statusText"),this.speciesScrapedCounter=0,this.init=function(){this.initLakesWithIFishPages()},this.initLakesWithIFishPages=function(){console.log("lakeScraper.initLakesWithIFishPages()"),$.ajax({url:"http://www.ifishillinois.org/profiles/selector.php",type:"get",dataType:"text",success:function(e){var t=e.responseText,i=t.search('<div class="content_tab" id="tab1">'),c=t.substr(i),n=c.search('<div class="content_tab" id="tab2">'),a=c.substr(0,n);$(a).find("li").each(function(){var e=$(this).text(),t=$(this).children("a").attr("href"),i=new LakeInfo(e,t);s.lakes.push(i)})},complete:function(e,t){console.log("Number of lakes found:"+s.lakes().length),s.initSpeciesLists()},error:function(e,s,t){console.log(s+":"+t)}})},this.initSpeciesLists=function(){for(var e in s.lakes()){var t=s.lakes()[e],i="http://www.ifishillinois.org"+t.href();$.ajax({url:i,type:"get",dataType:"text",context:t,success:s.scrapeSpecies,complete:s.scrapeSpeciesFinished,error:function(e,s,t){console.log(s+":"+t)}})}},this.scrapeSpecies=function(e,t,i){console.log("scraping species for "+this.name());var c=this;s.statusText.text("scraping: "+c.name());var n=e.responseText,a="<strong>County: </strong>",r=n.search(a);if(r>-1){r+=a.length,n=n.substr(r);var o=n.search("</p>");if(o>-1){var p=n.substr(0,o).trim();c.county(p),n=n.substr(o)}}var l=n.search('<div id="species">');if(l>-1){var h=n.substr(l),u=h.search("<!--closes species-->");if(u>-1){var f=h.substr(0,u);$(f).find("td a").each(function(){var e=$(this).text().trim();c.species.push(e)}),console.log("Number of species found:"+c.species().length),console.log("species: "+c.species())}}},this.scrapeSpeciesFinished=function(e,t){s.speciesScrapedCounter=s.speciesScrapedCounter+1,console.log("Number of lakes' species scraped: "+s.speciesScrapedCounter),s.lakes().length===s.speciesScrapedCounter&&(console.log("All done scraping species"),s.statusText.text("Done scraping"))}};