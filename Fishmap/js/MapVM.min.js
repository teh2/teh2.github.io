function showMap(){var e={center:{lat:42.105287,lng:-87.939661},zoom:8},n=$("#mapView")[0];mapVM.setMap(new google.maps.Map(n,e)),mapVM.infoWindow=new google.maps.InfoWindow({content:$("#lakeDetails").html()}),viewModel.init()}var MapVM=function(){var e=this;this.map,this.infoWindow,this.selectedLake,this.selectedMarker,this.setMap=function(n){e.map=n},this.getIconUrl=function(e){return 0<e.species().length?"images/fishicon.png":"images/unkfishicon.png"},this.getSelectedIconUrl=function(e){return 0<e.species().length?"images/selfishicon.png":"images/unkselfishicon.png"},this.buildMarker=function(n){if(0<n.latlon().length){var t=n.latlon().split(","),a=new google.maps.LatLng(t[0],t[1]),o={url:e.getIconUrl(n),size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,16)},i=new google.maps.Marker({map:null,position:a,title:n.name(),icon:o});n.marker(i),google.maps.event.addListener(i,"click",function(){viewModel.setCurrentLake(n)})}},this.loadMapApi=function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5nj4Q9nLWhbewfJYIjARH-HheRPHCKgE&callback=showMap",document.body.appendChild(e)},this.removeMapMarkers=function(){viewModel.lakes().forEach(function(e){e.marker()&&e.marker().setMap(null)})},this.addMapMarkers=function(){var n=new google.maps.LatLngBounds;n.extend(e.map.getCenter()),viewModel.getFilteredLakes().forEach(function(t){"undefined"!=typeof t.marker()&&(t.marker().setMap(e.map),n.extend(t.marker().getPosition()))}),e.map.fitBounds(n)},this.wireUpMapMarkers=function(){lakeListVM.filteredLakes.subscribe(function(n){e.removeMapMarkers(),e.addMapMarkers()})},this.setupInfoWindow=function(){e.unselectMarker(),e.selectedLake=viewModel.getCurrentLake(),e.selectMarker(),viewModel.setLocation(e.selectedLake.lat(),e.selectedLake.lon())},this.displayInfo=function(){e.infoWindow.setContent($("#lakeDetails").html()),e.infoWindow.open(e.map,e.selectedLake.marker())},this.unselectMarker=function(){if("undefined"!=typeof e.selectedMarker){var n={url:e.getIconUrl(e.selectedLake),size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,16)};e.selectedMarker.setIcon(n)}},this.selectMarker=function(){e.selectedMarker=e.selectedLake.marker();var n={url:e.getSelectedIconUrl(e.selectedLake),size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,16)};e.selectedMarker.setIcon(n)}};